!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("xgplayer"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.splice.js"),require("core-js/modules/es.promise.js"),require("core-js/modules/es.function.name.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/web.url.js"),require("core-js/modules/web.url-search-params.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.typed-array.uint8-array.js"),require("core-js/modules/esnext.typed-array.at.js"),require("core-js/modules/es.typed-array.copy-within.js"),require("core-js/modules/es.typed-array.every.js"),require("core-js/modules/es.typed-array.fill.js"),require("core-js/modules/es.typed-array.filter.js"),require("core-js/modules/es.typed-array.find.js"),require("core-js/modules/es.typed-array.find-index.js"),require("core-js/modules/esnext.typed-array.find-last.js"),require("core-js/modules/esnext.typed-array.find-last-index.js"),require("core-js/modules/es.typed-array.for-each.js"),require("core-js/modules/es.typed-array.includes.js"),require("core-js/modules/es.typed-array.index-of.js"),require("core-js/modules/es.typed-array.iterator.js"),require("core-js/modules/es.typed-array.join.js"),require("core-js/modules/es.typed-array.last-index-of.js"),require("core-js/modules/es.typed-array.map.js"),require("core-js/modules/es.typed-array.reduce.js"),require("core-js/modules/es.typed-array.reduce-right.js"),require("core-js/modules/es.typed-array.reverse.js"),require("core-js/modules/es.typed-array.set.js"),require("core-js/modules/es.typed-array.slice.js"),require("core-js/modules/es.typed-array.some.js"),require("core-js/modules/es.typed-array.sort.js"),require("core-js/modules/es.typed-array.subarray.js"),require("core-js/modules/es.typed-array.to-locale-string.js"),require("core-js/modules/es.typed-array.to-string.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.regexp.test.js"),require("core-js/modules/es.regexp.constructor.js"),require("core-js/modules/es.regexp.sticky.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.string.match.js"),require("core-js/modules/es.string.replace.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.join.js")):"function"==typeof define&&define.amd?define(["xgplayer","core-js/modules/es.array.concat.js","core-js/modules/es.object.to-string.js","core-js/modules/es.array.splice.js","core-js/modules/es.promise.js","core-js/modules/es.function.name.js","core-js/modules/es.array.iterator.js","core-js/modules/es.string.iterator.js","core-js/modules/web.dom-collections.iterator.js","core-js/modules/web.url.js","core-js/modules/web.url-search-params.js","core-js/modules/es.array.map.js","core-js/modules/es.object.keys.js","core-js/modules/es.array.find.js","core-js/modules/es.typed-array.uint8-array.js","core-js/modules/esnext.typed-array.at.js","core-js/modules/es.typed-array.copy-within.js","core-js/modules/es.typed-array.every.js","core-js/modules/es.typed-array.fill.js","core-js/modules/es.typed-array.filter.js","core-js/modules/es.typed-array.find.js","core-js/modules/es.typed-array.find-index.js","core-js/modules/esnext.typed-array.find-last.js","core-js/modules/esnext.typed-array.find-last-index.js","core-js/modules/es.typed-array.for-each.js","core-js/modules/es.typed-array.includes.js","core-js/modules/es.typed-array.index-of.js","core-js/modules/es.typed-array.iterator.js","core-js/modules/es.typed-array.join.js","core-js/modules/es.typed-array.last-index-of.js","core-js/modules/es.typed-array.map.js","core-js/modules/es.typed-array.reduce.js","core-js/modules/es.typed-array.reduce-right.js","core-js/modules/es.typed-array.reverse.js","core-js/modules/es.typed-array.set.js","core-js/modules/es.typed-array.slice.js","core-js/modules/es.typed-array.some.js","core-js/modules/es.typed-array.sort.js","core-js/modules/es.typed-array.subarray.js","core-js/modules/es.typed-array.to-locale-string.js","core-js/modules/es.typed-array.to-string.js","core-js/modules/web.dom-collections.for-each.js","core-js/modules/es.array.slice.js","core-js/modules/es.regexp.exec.js","core-js/modules/es.regexp.test.js","core-js/modules/es.regexp.constructor.js","core-js/modules/es.regexp.sticky.js","core-js/modules/es.regexp.to-string.js","core-js/modules/es.string.match.js","core-js/modules/es.string.replace.js","core-js/modules/es.array.filter.js","core-js/modules/es.array.join.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).MusicPreset=t(e.Player)}(this,(function(e){"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function r(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?t(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function s(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,r){return(t=h(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=c(e);if(t){var n=c(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return d(this,r)}}function h(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var y=function(){function e(t,r){i(this,e),this.url=t;var n=new window.XMLHttpRequest;n.target=this,n.responseType="arraybuffer",n.open("get",t),n.onload=function(){200!==n.status&&206!==n.status||r&&r instanceof Function&&r(n.response)},n.onerror=function(e){},this.xhr=n,this.run()}return s(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"run",value:function(){1===this.xhr.readyState&&this.xhr.send()}}]),e}(),p={ORDER:"order",SLOOP:"sloop",LOOP:"loop",RANDOM:"random"},m="xgplayer-music";function g(e,t,r){var i=Math.floor(Math.random()*(t-e)+e);return i===r?(i>t/2?t/=2:e=t/2,t-e>2?g(e,t,r):i):i}var v=function(t){a(c,t);var n=f(c);function c(){var e;i(this,c);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return o(u(e=n.call.apply(n,[this].concat(r))),"_onEnded",(function(){if("order"===e.mode&&e.index+1>=e.list.length)return e.player.pause(),void(e.player.currentTime=0);if(e.mode===p.SLOOP)e.change();else e.next()})),o(u(e),"_onDurationChange",(function(){var t=e.config.abCycle;e._initABCycle(t,e.player)})),o(u(e),"_onTimeUpdate",(function(){var t=u(e),r=t.config,i=t.player;if(!e.halfPass&&i.currentTime>i.duration/2&&e.confirmOrder(),r.abCycle){var n=r.abCycle,s=n.end>i.duration?i.duration:n.end;i.currentTime>=s?(n.loop||(i.pause(),e.emit("abCycle_ended")),i.currentTime=n.start||0):i.currentTime<n.start&&(i.currentTime=n.start||0)}})),e}return s(c,[{key:"afterCreate",value:function(){var t=this.player,r=this.playerConfig;e.Util.addClass(t.root,m),this.halfPass=!1,this.list=this.config.list||[],this.nextIndex=-1,this.prevIndex=-1,this.history=[],this.disable=!(this.list.length>0),0!==this.list.length&&(!r.url&&this.list.length>0&&(r.url=this.list[0].src),r.poster||(r.poster=this.list[0].poster),r.title||(r.title=this.list[0].title||""),r.vid||(r.vid=this.list[0].vid||""),this._curInfo={src:r.url,poster:r.poster,title:r.title,vid:r.vid},this.index=0,this.on(e.Events.TIME_UPDATE,this._onTimeUpdate),this.on(e.Events.ENDED,this._onEnded),this.on(e.Events.DURATION_CHANGE,this._onDurationChange),this.config.offline&&this.checkOffline(this._curInfo.src,this._curInfo.vid).then((function(e){0===e.code&&(r.url=e.url,t.state>=4&&(t.src=e.url))})).catch((function(e){})))}},{key:"destroy",value:function(){e.Util.removeClass(this.player.root,m)}},{key:"_nextCompute",value:function(){if(!this.disable)switch(this.mode){case p.SLOOP:case p.ORDER:case p.LOOP:this.index+1<this.list.length?this.nextIndex=this.index+1:this.nextIndex=0;break;default:this.nextIndex=g(0,this.list.length,this.index)}}},{key:"_prevCompute",value:function(){if(!this.disable)switch(this.mode){case p.SLOOP:case p.ORDER:case p.LOOP:this.index-1>=0?this.prevIndex=this.index-1:this.prevIndex=this.list.length-1;break;default:this.prevIndex=g(0,this.list.length,this.index)}}},{key:"_emitChange",value:function(){this.emit("change",this._curInfo)}},{key:"_initABCycle",value:function(e,t){var r=t.plugins.progresspreview;if(e&&t){var i=e.end>this.player.duration?this.player.duration:e.end,n=e.start>this.player.duration?0:e.start,s={id:t.playerId,time:e.start,duration:i-n,text:e.text,color:e.color};r.findDot(s.id)?r.updateDot(s):r.createDot(s)}else r.findDot(t.playerId)&&r.deleteDot(t.playerId)}},{key:"random",value:function(){if(this.list.length<0)return null;var e=g(0,this.list.length,this.index);return this.list[e]}},{key:"next",value:function(){this.disable||(this.halfPass||(this.halfPass=!0,this._nextCompute()),this.index=this.nextIndex,this.change())}},{key:"prev",value:function(){this.disable||(this.halfPass||(this.halfPass=!0,this._prevCompute()),this.index=this.prevIndex,this.change())}},{key:"forward",value:function(){var e=this.player,t=this.config.timeScale;e.currentTime=e.currentTime+t<e.duration?e.currentTime+t:e.duration-.1}},{key:"backward",value:function(){var e=this.player,t=this.config.timeScale;e.currentTime=e.currentTime-t>0?e.currentTime-t:0}},{key:"add",value:function(e){this.list.push({src:e.src,title:e.title,vid:e.vid,poster:e.poster})}},{key:"remove",value:function(e){var t=-1;this.list.every((function(r,i){return r.vid!==e||(t=i,!1)})),t>-1&&this.list.splice(t,1)}},{key:"setAbCycle",value:function(t,i,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t&&"Object"===e.Util.typeof(t)?this.config.abCycle=r({},t):this.config.abCycle=r({start:t||0,end:i||this.player.duration,loop:n},s),this._initABCycle(this.config.abCycle,this.player)}},{key:"removeAbCycle",value:function(){this.config.abCycle=null,this._initABCycle(null,this.player)}},{key:"updateList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.removeAbCycle(),this.player.pause(),this.player.currentTime=0,this.list=e,this.nextIndex=0,this.index=0,this.change()}},{key:"setIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e<0||e>=this.list.length||(this.nextIndex=e,this.index=e,this.change())}},{key:"change",value:function(){var e=this;if(!this.disable){var t=this.player,r=this.list,i=this.index,n=r[i].vid;this.halfPass=!1,this.checkOffline(r[i].src,n).then((function(r){e._curInfo={title:e.list[e.index].title||"",vid:e.list[e.index].vid,poster:e.list[e.index].poster||"",src:r.url},t.playNext({url:r.url,vid:e.list[e.index].vid||0,poster:e.list[e.index].poster||"",autoplay:!0}),t.off("timeupdate",e._emitChange),t.once("timeupdate",e._emitChange),t.play()}))}}},{key:"checkOffline",value:function(e,t){var r=this;return new Promise((function(i,n){r.config.offline&&!r.disable||i({url:e,code:-1,vid:t});var s=r.player.database;s.openDB((function(){s.getDataByKey(s.myDB.ojstore.name,t,(function(r){setTimeout((function(){s.closeDB()}),5e3),i(r?{url:URL.createObjectURL(r.blob),code:0,vid:r.vid}:{url:e,code:-2,vid:t})}))}))}))}},{key:"confirmOrder",value:function(){this.halfPass=!0,this._nextCompute(),this._prevCompute(),this.config.preloadNext&&this.preload(this.nextIndex)}},{key:"preload",value:function(e){if(!(e<0||e>=this.list.length)){var t=this.list[e],r=this.player;this.checkOffline(t.src,t.vid).then((function(e){if(-2===e.code){var i=t.vid;new y(t.src,(function(e){r.database.openDB((function(){r.database.addData(r.database.myDB.ojstore.name,[{vid:i,blob:new Blob([e],{type:'audio/mp4; codecs="mp4a.40.5"'})}]),setTimeout((function(){r.database.closeDB()}),5e3)}))}))}}))}}},{key:"timeScale",get:function(){return this.config.timeScale||15},set:function(e){this.config.timeScale=e}},{key:"mode",get:function(){return this.config.mode||p.RANDOM},set:function(e){this.config.mode=e}}],[{key:"pluginName",get:function(){return"music"}},{key:"defaultConfig",get:function(){return{offline:!1,preloadNext:!0,abCycle:null,timeScale:15,mode:p.ORDER,list:[]}}},{key:"ModeType",get:function(){return Object.keys(p).map((function(e){return p[e]}))}}]),c}(e.BasePlugin),j=function(t){a(n,t);var r=f(n);function n(){return i(this,n),r.apply(this,arguments)}return s(n,[{key:"afterCreate",value:function(){var e=this;if(this.on("change",(function(t){if(t&&t.poster){if(e.find("img"))e.find("img").src=t.poster;else{var r=new Image;r.src=t.poster,e.appendChild(r)}e.find("img").src=t.poster,e.show()}else e.hide()})),this.playerConfig.poster){var t=new Image;t.src=this.playerConfig.poster,this.appendChild(t)}}},{key:"render",value:function(){return'<xg-icon class="xgplayer-cover"></xg-icon>'}}],[{key:"pluginName",get:function(){return"musiccover"}},{key:"defaultConfig",get:function(){return{index:6,position:e.Plugin.POSITIONS.CONTROLS_LEFT}}}]),n}(e.Plugin),x=function(t){a(n,t);var r=f(n);function n(){var e;i(this,n);for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return o(u(e=r.call.apply(r,[this].concat(s))),"onClick",(function(t){var r=u(e).player;t.preventDefault(),t.stopPropagation(),r.plugins.music.backward()})),e}return s(n,[{key:"afterCreate",value:function(){var e=this;this.initIcons();["click","touchstart"].forEach((function(t){e.bind(t,e.onClick)}))}},{key:"registerIcons",value:function(){return{musicBackward:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="-2 0 21 15">\n      <path d="m 14,2.99996 0,10 -7,-5 7,-5 z m -7,5 0,5 -7,-5 7,-5 0,5 z m -7,0 0,0 z"></path>\n  </svg>',class:"xg-icon-mbackward"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.musicBackward)}},{key:"destroy",value:function(){var e=this;["click","touchstart"].forEach((function(t){e.unbind(t,e.onClick)}))}},{key:"render",value:function(){return'<xg-icon class="xgplayer-backward">\n            <div class="xgplayer-icon">\n            </div>\n          </xg-icon>'}}],[{key:"pluginName",get:function(){return"musicbackward"}},{key:"defaultConfig",get:function(){return{index:1,position:e.Plugin.POSITIONS.CONTROLS_LEFT}}}]),n}(e.Plugin),_=function(t){a(n,t);var r=f(n);function n(){var e;i(this,n);for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return o(u(e=r.call.apply(r,[this].concat(s))),"onClick",(function(t){var r=u(e).player;t.preventDefault(),t.stopPropagation(),r.plugins.music.prev()})),e}return s(n,[{key:"afterCreate",value:function(){var e=this;this.initIcons();["click","touchstart"].forEach((function(t){e.bind(t,e.onClick)}))}},{key:"registerIcons",value:function(){return{musicPrev:{icon:' <svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" viewBox="300 200 1024 1024">\n        <path d="M600 1140v-768h128v352l320-320v704l-320-320v352zz"></path>\n    </svg>',class:"xg-icon-mprev"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.musicPrev)}},{key:"destroy",value:function(){var e=this;["click","touchstart"].forEach((function(t){e.unbind(t,e.onClick)}))}},{key:"render",value:function(){return'<xg-icon class="xgplayer-next">\n            <div class="xgplayer-icon">\n            </div>\n          </xg-icon>'}}],[{key:"pluginName",get:function(){return"musicprev"}},{key:"defaultConfig",get:function(){return{index:2,position:e.Plugin.POSITIONS.CONTROLS_LEFT}}}]),n}(e.Plugin),b=function(t){a(n,t);var r=f(n);function n(){var e;i(this,n);for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return o(u(e=r.call.apply(r,[this].concat(s))),"onClick",(function(t){var r=u(e).player;t.preventDefault(),t.stopPropagation(),r.plugins.music.forward()})),e}return s(n,[{key:"afterCreate",value:function(){var e=this;this.initIcons();["click","touchstart"].forEach((function(t){e.bind(t,e.onClick)}))}},{key:"registerIcons",value:function(){return{musicForward:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="-2 0 21 15">\n        <path d="m 2,2.99996 0,10 7,-5 -7,-5 z m 7,5 0,5 7,-5 -7,-5 0,5 z m 7,0 0,0 z"></path>\n      </svg>',class:"xg-icon-mforward"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.musicForward)}},{key:"destroy",value:function(){var e=this;["click","touchstart"].forEach((function(t){e.unbind(t,e.onClick)}))}},{key:"render",value:function(){return'<xg-icon class="xgplayer-forward">\n            <div class="xgplayer-icon">\n            </div>\n          </xg-icon>'}}],[{key:"pluginName",get:function(){return"musicforward"}},{key:"defaultConfig",get:function(){return{index:5,position:e.Plugin.POSITIONS.CONTROLS_LEFT}}}]),n}(e.Plugin),k=function(t){a(n,t);var r=f(n);function n(){var e;i(this,n);for(var t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return o(u(e=r.call.apply(r,[this].concat(s))),"onClick",(function(t){var r=u(e).player;t.preventDefault(),t.stopPropagation(),r.plugins.music.next()})),e}return s(n,[{key:"afterCreate",value:function(){var e=this;this.initIcons();["click","touchstart"].forEach((function(t){e.bind(t,e.onClick)}))}},{key:"registerIcons",value:function(){return{musicNext:{icon:' <svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" viewBox="100 200 1024 1024">\n        <path d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z">\n      </svg>',class:"xg-icon-mnext"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.musicNext)}},{key:"destroy",value:function(){var e=this;["click","touchstart"].forEach((function(t){e.unbind(t,e.onClick)}))}},{key:"render",value:function(){return'<xg-icon class="xgplayer-next">\n            <div class="xgplayer-icon">\n            </div>\n          </xg-icon>'}}],[{key:"pluginName",get:function(){return"musicnext"}},{key:"defaultConfig",get:function(){return{index:4,position:e.Plugin.POSITIONS.CONTROLS_LEFT}}}]),n}(e.Plugin),w=function(e){a(r,e);var t=f(r);function r(){return i(this,r),t.apply(this,arguments)}return s(r,[{key:"beforeCreate",value:function(e){var t=e.player.plugins.progress;t&&(e.root=t.root)}},{key:"afterCreate",value:function(){var e=this;this.on("change",(function(t){t&&t.title?e.root.innerHTML="".concat(t.title):e.root.innerHTML=""}))}},{key:"render",value:function(){var e=this.playerConfig;return'<xg-title class="xgplayer-name">\n          '.concat(e.title||"","\n       </xg-title>")}}],[{key:"pluginName",get:function(){return"musicmeta"}},{key:"defaultConfig",get:function(){return{index:0}}}]),r}(e.Plugin);var C=s((function t(n,s){i(this,t),console.log("config",n,s),console.log("playerConfig","Object"!==e.Util.typeOf(s.controls)),function(t){if("Object"!==e.Util.typeOf(t.controls))t.controls={mode:"flex",initShow:!0};else{var i=t.controls;t.controls=r({mode:"flex",initShow:!0},i)}var n=t.play||{};t.play=r({index:3},n),t.marginControls=!0,t.mediaType="audio"}(s),this.plugins=[v,x,_,b,k,j,w],this.ignores=["start","cssFullScreen","fullscreen","pip","enter","replay","pc","loading","poster"]}));function O(e,t,r){for(var i=e.createLinearGradient(0,0,t,0),n=100/r.length,s=0;s<r.length;s++)i.addColorStop(n*s/100,r[s]);return i}function S(e,t,r,i){var n=r.w,s=r.linear,o=r.reverse,a=r.offset;e.save(),e.beginPath();var c=1*n/i;e.strokeStyle=s;for(var l=0,u=0,d=0;d<i;d++)u=a-(u=o?0-t[d]:t[d]),0===d?e.moveTo(l,u):e.lineTo(l,u),l+=c;e.lineTo(n,u),e.stroke()}var P={bars:function(e){var t=e.data,r=e.options,i=e.ctx,n=e.h,s=e.w,o=t.length>r.count?r.count:t.length,a=parseInt(n/255*2,10);i.clearRect(0,0,s,n),i.fillStyle=r.bgColor,i.fillRect(0,0,s,n);for(var c,l=s/o,u=l-l/4,d=0,f=r.linear,h=0;h<o;h++)c=t[h],i.fillStyle=f,i.fillRect(d,n-c,u,c*a+n/2),d+=l},vertLines:function(e){var t=e.data,r=e.options,i=e.ctx,n=e.h,s=e.w,o=r.count||128;t.length<o&&(o=t.length);var a=n/255,c=s/o,l=r.linear;i.clearRect(0,0,s,n),i.fillStyle=r.bgColor,i.fillRect(0,0,s,n);for(var u=1;u<=o;u++){var d=t[u];d*=a;var f=c*u;i.moveTo(f,n),i.lineTo(f,n-d),i.strokeStyle=l,i.stroke(),i.beginPath()}},lightning:function(e){var t=e.data,r=e.options,i=e.ctx,n=e.h,s=e.w,o=t.length>r.count?r.count:t.length;i.clearRect(0,0,s,n),i.fillStyle=r.bgColor,i.fillRect(0,0,s,n),i.beginPath();var a=r.linear;i.strokeStyle=a;for(var c=s/o,l=0,u=0;u<o;u++){var d=t[u]/128*n/2;0===u?i.moveTo(l,d):i.lineTo(l,d),l+=c}i.lineTo(s,n/2),i.stroke()},doubleLine:function(e){var t=e.data,r=e.options,i=e.ctx,n=e.h,s=e.w,o=n/255,a=s/128,c=r.count||128;i.clearRect(0,0,s,n),i.fillStyle=r.bgColor,i.fillRect(0,0,s,n);for(var l=r.linear,u=1;u<=c;u++){var d=t[u];d+=5;var f=a*u,h=n/2+(d*=o)/2;i.moveTo(f,h),i.lineTo(f,h-d),i.strokeStyle=l,i.stroke(),i.beginPath()}},doubleBars:function(e){var t=e.data,r=e.options,i=e.ctx,n=e.h,s=e.w,o=t.length>r.count?r.count:t.length,a=n/255;i.clearRect(0,0,s,n),i.fillStyle=r.bgColor,i.fillRect(0,0,s,n);for(var c,l=s/o,u=l-l/4,d=0,f=r.linear,h=0;h<o;h++)c=t[h]*a,i.fillStyle=f,i.fillRect(d,n/2+c/2,u,-c),d+=l},waves:function(e){var t=e.options,r=e.ctx,i=e.h,n=e.w,s=e.data,o=t.colors;s=function(e,t){(!t||t<1)&&(t=e.length*t);for(var r=[],i=Math.floor(e.length/t),n=1;n<=t;n++){var s=e.slice(n*i,n*i+i),o=s[Math.floor(s.length/2)];r.push(o)}return r}(s,2048),s=function(e,t){for(var r=Math.floor(e.length/t),i=[],n=[],s=0,o=0;o<=r*t;o++)s===r&&(i.push(n),n=[],s=0),n.push(e[o]),s++;return i}(s=function(e,t){var r=t/255;return t<=3&&t>=0&&(r=t),e.map((function(e){return e*r}))}(s,i/2),4).slice(0,3),r.clearRect(0,0,n,i),r.fillStyle=t.bgColor,r.fillRect(0,0,n,i);for(var a=0;a<s.length;a++)S(r,s[a],{linear:o[a],w:n,h:i,offset:i/2,reverse:!1},s[a].length),S(r,s[a],{linear:o[a],w:n,h:i,offset:i/2,reverse:!0},s[a].length)}},T={bars:2,vertLines:1,lightning:2,doubleLine:1,doubleBars:2,waves:2},q={BARS:"bars",VERT_LINES:"vertLines",LIGHTNING:"lightning",DOUBLE_LINE:"doubleLine",DOUBLE_BARS:"doubleBars",WAVES:"waves"};function I(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(t){(i=r({},i)).stroke||(i.stroke=1),i.colors||(i.colors=["#ff8177","#cf556c","#f99185","#b12a5b"]);var s=t.getContext("2d"),o=t.height,a=t.width;s.strokeStyle=i.colors[0],s.lineWidth=i.stroke;var c={data:e,options:i,ctx:s,h:o,w:a};"string"==typeof i.mode&&(i.mode=[i.mode]),i.mode.forEach((function(e){n%T[e]==0&&(s.clearRect(0,0,a,o),s.beginPath(),P[e](c))}))}}var E=function(){function e(t,r){var n=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,e),o(this,"start",(function(){n.reqId||n._renderFrame()})),o(this,"stop",(function(){cancelAnimationFrame(n.reqId),n.reqId=null})),o(this,"_onDestroy",(function(){n._audioCtx.close()})),o(this,"_onoVolumechange",(function(){console.log("onoVolumechange"),n.gainNode.gain.setValueAtTime(n.player.volume,n.player.currentTime)})),o(this,"_renderFrame",(function(){n.reqId&&cancelAnimationFrame(n.reqId),n.reqId=requestAnimationFrame(n._renderFrame),n.frameCount++,"lightning"===n.mode?n.analyser.getByteTimeDomainData(n.dataArray):n.analyser.getByteFrequencyData(n.dataArray),I.call(n,n.dataArray,n.canvas,n.options,n.frameCount)})),this.canvas=r;var a=this.canvas.getBoundingClientRect(),c=a.width,l=a.height;if(this.canvas.width=2*c,this.canvas.height=2*l,this.player=t,this.options=e.defaultConfig,Object.keys(s).map((function(e){n.options[e]=s[e]})),e.AudioCtx){t.audioCtx?this._audioCtx=t.audioCtx:this._audioCtx=new e.AudioCtx,this.analyser=this._audioCtx.createAnalyser();var u=this._audioCtx.createGain();u.gain.setValueAtTime(t.volume,t.currentTime),this.gainNode=u,this.source=this._audioCtx.createMediaElementSource(t.video),this.ctx=r.getContext("2d"),this.source.connect(this.analyser),this.analyser.connect(u),this.fftSize=this.options.fftSize,this.frameCount=0,this.options.isGradient&&(this.options.linear=O(this.ctx,r.width,this.options.colors)),u.connect(this._audioCtx.destination),this._initPlayerEvents()}}return s(e,[{key:"_initPlayerEvents",value:function(){var e=this;["play","playing","seeked"].forEach((function(t){e.player.on(t,e.start)})),this.player.on("volumechange",this._onoVolumechange),this.player.on("destroy",this._onDestroy)}},{key:"destroy",value:function(){var e=this;this.stop(),["play","playing","seeked"].forEach((function(t){e.player.off(t,e.start)})),this.player.off("volumechange",this._onoVolumechange),this.player.off("destroy",this._onDestroy),this._audioCtx.close()}},{key:"mode",get:function(){return this.options.mode},set:function(e){this.options.mode=e}},{key:"fftSize",get:function(){return 2*this.analyser.frequencyBinCount},set:function(e){this.analyser.fftSize=e;var t=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(t)}}],[{key:"defaultConfig",get:function(){return{fftSize:16384,count:1024,mode:"bars",colors:["#ff8177","#cf556c","#f99185","#b12a5b"],stroke:2,bgColor:"#000",isGradient:!0,linear:null}}},{key:"MODES",get:function(){return q}},{key:"AudioCtx",get:function(){return window.AudioContext||window.webkitAudioContext}}]),e}(),D=s((function e(t){i(this,e),this.regRule=/(\d{2}(?=:)):(\d{2}(?=\.))\.(\d{2,3})/g,this.regRule.test(t)?this.time=60*RegExp.$1+1*RegExp.$2+1*("0."+RegExp.$3):this.time=-1})),R=function(){function t(e,r){var n=this;i(this,t),this.rawTxts=e,this.txts=e.map((function(e){return e.replace(/^[\r\n]|[\r\n]$/g,"").match(/(\[.*\])[^[]+/g)})),this.isDynamics=e.map((function(e,t){return[].concat(e.match(/\[\d{2}:\d{2}\.\d{2,3}\]/g)).length===n.txts[t].length&&n.txts[t].length===n.txts[0].length&&n.txts[t].length>1})),this.isDynamic=this.isDynamics.some((function(e){return e})),this.__ainimateInterval__=0,this.__offset__=0,this.__offsetScale__=.5,this.dom=r,this.lists=[],this.isDynamics.map((function(e,t){e&&n.lists.push(n.txts[t].map((function(e,t){var r=/(\[[\d:\S]+\])([^[]+)/g.test(e),i=RegExp.$1,n=RegExp.$2;return{time:r?new D(i).time:-1,lyric:n,idx:t}})))})),this.list=this.lists.reduce((function(e,t){return e.map((function(e,r){return{time:e.time,lyric:"\n"===e.lyric?"".concat(e.lyric).concat(t[r].lyric):"".concat(e.lyric,"<br/>").concat(t[r].lyric),idx:r}}))})),this.line=0}return s(t,[{key:"interval",get:function(){return this.__ainimateInterval__},set:function(e){this.__ainimateInterval__=e}},{key:"offset",get:function(){return this.__offset__},set:function(e){this.__offset__=e}},{key:"offsetScale",get:function(){return this.__offsetScale__},set:function(e){this.__offsetScale__=e}},{key:"adjust",value:function(){for(var e,t,r=this.list,i=0,n=r.length;i<n;i++){for(e=i+1;e<n&&!(r[e].time>r[i].time);e++);if(e<n){var s=(r[e].time-r[i].time)/(e-i);for(t=i+1;t<e;t++)r[t].time=r[t-1].time+s}}}},{key:"find",value:function(e){var t=this.list,r=this.__ainimateInterval__,i=this.__offset__;return e=e+i>0?e+i:0,t.filter((function(i,n){var s=i.time,o=n+1;return e>=s&&(t[o]&&1*e+1*r<=t[o].time||o>=t.length)}))}},{key:"bind",value:function(e){var t=this,r=this;return this.__player__=e,!!r.isDynamic&&(r.__handle__=function(){var r=t.find(e.currentTime)[0];r&&r.idx!==t.line&&(t.line=r.idx,e.emit("lyricUpdate",r))}.bind(r,e),e.on("timeupdate",r.__handle__),r.__startHandle__=function(){e.emit("lyricUpdate",r.list[0])}.bind(r,e),e.once("playing",r.__startHandle__),!0)}},{key:"unbind",value:function(e){delete this.__player__,this.__handle__&&(e.off("lyricUpdate",this.__handle__),delete this.__handle__)}},{key:"show",value:function(){var t=this,r=this.dom,i=[],n=this,s=["click","touchstart"];if(r&&1===r.nodeType){var o=e.Util.createDom("div","<div></div>",{},"xgplayer-lrcWrap");r.appendChild(o),this.list.forEach((function(e){i.push('<xg-lyric-item class="xgplayer-lyric-item" data-idx="'.concat(e.idx,'">').concat(e.lyric.replace(/[\r\n]/g,""),"</xg-lyric-item>"))})),o.innerHTML=i.join("");var a=e.Util.createDom("xg-lrcForward","<div></div>",{},"xgplayer-lrcForward");r.appendChild(a),s.forEach((function(e){a.addEventListener(e,(function(e){e.preventDefault(),e.stopPropagation(),n.offset-=n.offsetScale,console.log("lyric go forward ".concat(n.offsetScale,"s"))}),!1)}));var c=e.Util.createDom("xg-lrcBack","<div></div>",{},"xgplayer-lrcBack");r.appendChild(c),s.forEach((function(e){c.addEventListener(e,(function(e){e.preventDefault(),e.stopPropagation(),n.offset+=n.offsetScale,console.log("lyric go back ".concat(n.offsetScale,"s"))}),!1)})),this.__updateHandle__=function(e){var r,i=t.dom.querySelector(".xgplayer-lrcWrap"),n=i.querySelector(".xgplayer-lyric-item-active"),s=i.offsetHeight;n&&(n.className="xgplayer-lyric-item"),(n=i.querySelector('.xgplayer-lyric-item[data-idx="'.concat(e.idx,'"]')))&&(n.className="xgplayer-lyric-item xgplayer-lyric-item-active",(r=n.getBoundingClientRect().top-i.getBoundingClientRect().top+i.scrollTop-s/2)&&(i.scrollTop=r))},this.__player__.on("lyricUpdate",this.__updateHandle__)}else this.__player__.emit("error","lyric container can not be empty")}},{key:"hide",value:function(){this.__updateHandle__.off("lyricUpdate",this.__updateHandle__)}}]),t}();return C.Analyze=E,C.Lyric=R,C.Music=v,C}));
//# sourceMappingURL=index.min.js.map
